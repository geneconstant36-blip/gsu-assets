<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cross Figures Game | Math Crossword Puzzle | GSU</title>
<meta name="description" content="Solve math crossword puzzles! Use clues to fill numbers into the grid. Free brain teaser with multiple difficulty levels from Global Sovereign University.">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Oswald:wght@700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--navy:#0a1628;--blue:#1e3a5f;--gold:#ffd700;--teal:#0f766e;--cream:#f5f0e8;--slate:#94a3b8;--green:#4ade80;--red:#ef4444}
body{font-family:'Inter',sans-serif;background:var(--navy);color:var(--cream);min-height:100vh}
.game-wrap{max-width:960px;margin:0 auto;padding:20px}

/* Nav Bar */
.nav-bar{display:flex;justify-content:space-between;align-items:center;padding:10px 0;margin-bottom:20px;border-bottom:1px solid rgba(255,255,255,.1)}
.nav-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:50px;font-size:13px;font-weight:600;text-decoration:none;transition:all .3s;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:var(--cream)}
.nav-btn:hover{background:rgba(255,255,255,.12);border-color:rgba(255,255,255,.3)}
.nav-gsu{border-color:var(--gold);color:var(--gold)}
.nav-gsu:hover{background:rgba(255,215,0,.15)}

/* Header */
.header{text-align:center;padding:20px 0 15px}
.header h1{font-family:'Oswald',sans-serif;font-size:2rem;color:var(--gold);letter-spacing:2px}
.subtitle{color:var(--slate);font-size:.9rem;margin-top:5px}
.badge-tag{display:inline-block;background:linear-gradient(135deg,var(--teal),#0d9488);color:var(--gold);padding:5px 16px;border-radius:50px;font-size:11px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:10px}

/* GENO */
.geno-bar{display:flex;align-items:center;gap:12px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:14px;margin-bottom:20px}
.geno-img{width:45px;height:45px;border-radius:50%;border:2px solid var(--gold);object-fit:cover}
.geno-speech{flex:1;font-size:.9rem;color:var(--slate);line-height:1.5}
.geno-name{color:var(--gold);font-weight:700;margin-right:6px}

/* Controls */
.controls{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap;align-items:center}
.ctrl-select{padding:8px 14px;border-radius:8px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);color:var(--cream);font-size:.85rem;font-family:'Inter',sans-serif}
.ctrl-btn{padding:8px 18px;border-radius:8px;background:var(--teal);border:none;color:var(--cream);font-weight:600;cursor:pointer;font-size:.85rem;transition:all .2s}
.ctrl-btn:hover{filter:brightness(1.2)}
.ctrl-btn.hint{background:rgba(255,215,0,.2);border:1px solid var(--gold);color:var(--gold)}

/* Game Area */
.game-area{display:grid;grid-template-columns:auto 1fr;gap:20px;align-items:start}
@media(max-width:700px){.game-area{grid-template-columns:1fr}}

/* Grid */
.grid-container{display:inline-block;background:rgba(0,0,0,.3);border:2px solid rgba(255,255,255,.15);border-radius:12px;padding:15px}
.grid{display:grid;gap:2px}
.cell{width:44px;height:44px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;font-weight:700;border-radius:4px;position:relative;cursor:pointer;transition:all .15s}
.cell.black{background:#111;cursor:default}
.cell.white{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12)}
.cell.white:hover{border-color:var(--gold)}
.cell.active{background:rgba(255,215,0,.15);border-color:var(--gold);box-shadow:0 0 8px rgba(255,215,0,.3)}
.cell.correct{background:rgba(74,222,128,.15);border-color:var(--green);color:var(--green)}
.cell.wrong{background:rgba(239,68,68,.15);border-color:var(--red);color:var(--red)}
.cell .clue-num{position:absolute;top:1px;left:3px;font-size:.55rem;color:var(--slate);font-weight:400}
.cell input{width:100%;height:100%;background:transparent;border:none;outline:none;color:var(--cream);font-size:1.1rem;font-weight:700;text-align:center;font-family:'Inter',sans-serif}

/* Clues */
.clues-panel{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:18px;max-height:500px;overflow-y:auto}
.clues-panel h3{font-family:'Oswald',sans-serif;color:var(--gold);font-size:1rem;margin-bottom:10px;letter-spacing:1px}
.clue-item{padding:6px 8px;margin-bottom:4px;border-radius:6px;font-size:.85rem;color:var(--slate);cursor:pointer;transition:all .15s;line-height:1.4}
.clue-item:hover{background:rgba(255,255,255,.06)}
.clue-item.active{background:rgba(255,215,0,.1);color:var(--cream)}
.clue-item.solved{color:var(--green);text-decoration:line-through;opacity:.6}

/* Stats */
.stats{display:flex;gap:15px;justify-content:center;margin:15px 0;flex-wrap:wrap}
.stat{text-align:center;padding:8px 16px;background:rgba(255,255,255,.04);border-radius:8px;border:1px solid rgba(255,255,255,.08)}
.stat-val{font-size:1.3rem;font-weight:800;color:var(--gold)}
.stat-lbl{font-size:.7rem;color:var(--slate);text-transform:uppercase;letter-spacing:1px}

/* Numpad */
.numpad{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-top:10px}
.num-btn{padding:10px;border-radius:8px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);color:var(--cream);font-size:1rem;font-weight:700;cursor:pointer;transition:all .15s;text-align:center}
.num-btn:hover{background:rgba(255,215,0,.15);border-color:var(--gold)}

/* Modal */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);z-index:1000;align-items:center;justify-content:center}
.modal.show{display:flex}
.modal-box{background:linear-gradient(135deg,var(--blue),#5c6bc0);border:4px solid var(--gold);border-radius:15px;padding:40px;text-align:center;max-width:400px;width:90%}
.modal-box h2{font-family:'Oswald',sans-serif;color:var(--gold);font-size:1.8rem;margin-bottom:10px}
.modal-box p{color:#b3e5fc;margin-bottom:15px}

/* Footer */
.footer{text-align:center;padding:20px 0;margin-top:20px;border-top:1px solid rgba(255,255,255,.08);color:var(--slate);font-size:.8rem}
.footer a{color:var(--gold);text-decoration:none}

/* Badges */
.badges{display:flex;gap:8px;justify-content:center;margin:10px 0;flex-wrap:wrap}
.badge-pill{padding:6px 12px;border-radius:15px;font-size:.75rem;font-weight:600;opacity:.35}
.badge-pill.earned{opacity:1;box-shadow:0 2px 10px rgba(255,215,0,.3)}
.badge-pill.bronze{background:linear-gradient(135deg,#cd7f32,#8b4513);border:2px solid #cd7f32}
.badge-pill.silver{background:linear-gradient(135deg,#c0c0c0,#808080);border:2px solid #c0c0c0}
.badge-pill.gold{background:linear-gradient(135deg,var(--gold),#ffa000);border:2px solid var(--gold);color:var(--navy)}
.badge-pill.platinum{background:linear-gradient(135deg,#e5e4e2,#b4b4b4);border:2px solid #e5e4e2;color:var(--navy)}
.voice-toggle{width:36px;height:36px;border-radius:50%;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--gold);cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0}
.voice-toggle:hover{background:rgba(255,215,0,.1)}
.voice-toggle.off{color:var(--slate);opacity:.5}
</style>
</head>
<body>
<div class="game-wrap">

<!-- Navigation -->
<div class="nav-bar">
  <a href="https://www.globalsovereignuniversity.org" class="nav-btn nav-gsu">üè† GSU Home</a>
  <a href="https://www.globalsovereignuniversity.org/mathification" class="nav-btn">üìê All Math Games</a>
</div>

<div class="badge-tag">Mathification ‚Ä¢ Band 1</div>
<div class="header">
  <h1>üß© CROSS FIGURES</h1>
  <div class="subtitle">Mathematical Crossword Puzzles ‚Ä¢ 50+ Challenges</div>
</div>

<!-- GENO -->
<div class="geno-bar">
  <img src="https://cdn.prod.website-files.com/690a4028667a2e2c27b665d0/6958183c01f7dfdad3fdb32b_Geno%20head.png" alt="GENO" class="geno-img" id="genoImg">
  <div class="geno-speech"><span class="geno-name">GENO:</span> <span id="genoTxt">Welcome to Cross Figures! Solve math clues and fill in the number grid. Click a clue to highlight cells, then use the number pad below.</span></div>
  <button class="voice-toggle" id="voiceBtn" title="Toggle GENO voice" onclick="toggleVoice()">üîä</button>
</div>

<!-- Controls -->
<div class="controls">
  <select class="ctrl-select" id="cfDiff">
    <option value="easy">üü¢ Easy</option>
    <option value="medium">üü° Medium</option>
    <option value="hard">üî¥ Hard</option>
  </select>
  <select class="ctrl-select" id="cfNum">
    <option value="0">Puzzle 1</option><option value="1">Puzzle 2</option><option value="2">Puzzle 3</option>
    <option value="3">Puzzle 4</option><option value="4">Puzzle 5</option>
  </select>
  <button class="ctrl-btn" onclick="cfLoad()">üîÑ New Puzzle</button>
  <button class="ctrl-btn" onclick="cfCheck()">‚úÖ Check</button>
  <button class="ctrl-btn hint" onclick="cfHint()">üí° Hint</button>
</div>

<div class="stats">
  <div class="stat"><div class="stat-val" id="cfSolved">0</div><div class="stat-lbl">Solved</div></div>
  <div class="stat"><div class="stat-val" id="cfHints">0</div><div class="stat-lbl">Hints</div></div>
  <div class="stat"><div class="stat-val" id="cfStreak">0</div><div class="stat-lbl">Streak</div></div>
</div>

<div class="badges">
  <span class="badge-pill bronze" id="cfBBronze">ü•â Bronze</span>
  <span class="badge-pill silver" id="cfBSilver">ü•à Silver</span>
  <span class="badge-pill gold" id="cfBGold">ü•á Gold</span>
  <span class="badge-pill platinum" id="cfBPlat">üíé Platinum</span>
</div>

<!-- Game Area -->
<div class="game-area">
  <div>
    <div class="grid-container"><div class="grid" id="cfGrid"></div></div>
    <div class="numpad" id="cfNumpad"></div>
  </div>
  <div class="clues-panel" id="cfClues"></div>
</div>

<!-- Modal -->
<div class="modal" id="cfModal">
  <div class="modal-box">
    <h2 id="cfModalTitle">üéâ Puzzle Complete!</h2>
    <p id="cfModalMsg"></p>
    <button class="ctrl-btn" onclick="cfNext()" style="margin-top:10px">Next Puzzle ‚Üí</button>
  </div>
</div>

<!-- Footer -->
<div class="footer">
  <p><a href="https://www.globalsovereignuniversity.org">Global Sovereign University</a> ‚Ä¢ 501(c)(3) Nonprofit</p>
  <p style="margin-top:5px">"Building a Bridge to Freedom Through Education‚ÄîNot Handouts"</p>
</div>

</div>

<script>
(function(){
const puzzles={easy:[
  {size:4,grid:[[1,2,-1,3],[4,-1,5,-1],[-1,6,-1,7],[8,-1,9,-1]],
   answers:[[3,6,0,9],[1,0,8,0],[0,2,0,5],[4,0,7,0]],
   across:{1:"Half of 72",3:"Dozen minus 3",4:"Square root of 100",6:"10√∑5",8:"16√∑4"},
   down:{1:"Months in a quarter",2:"Days in a week minus 1",5:"Fingers on one hand plus 3",7:"15√∑3"}},
  {size:4,grid:[[1,2,-1,3],[4,-1,5,-1],[-1,6,-1,7],[8,-1,9,-1]],
   answers:[[5,4,0,7],[2,0,3,0],[0,8,0,1],[6,0,9,0]],
   across:{1:"Nickels in a quarter",3:"Days in a week",4:"Even prime number",6:"Octagon sides",8:"Half a dozen"},
   down:{1:"Vowels count",2:"Square of 2",5:"Triangle sides",7:"9√ó1"}},
  {size:4,grid:[[1,2,-1,3],[4,-1,5,-1],[-1,6,-1,7],[8,-1,9,-1]],
   answers:[[7,2,0,4],[9,0,6,0],[0,5,0,8],[3,0,1,0]],
   across:{1:"Lucky number",3:"Seasons count",4:"Largest single digit",6:"Half of 10",8:"Tricycle wheels"},
   down:{1:"70√∑10",2:"Fingers on one hand √∑ 2.5",5:"48√∑8",7:"2¬≥"}},
  {size:4,grid:[[1,2,-1,3],[4,-1,5,-1],[-1,6,-1,7],[8,-1,9,-1]],
   answers:[[8,1,0,5],[4,0,9,0],[0,3,0,6],[7,0,2,0]],
   across:{1:"Legs on a spider",3:"Senses count",4:"Half of 8",6:"21√∑7",8:"Rainbow colors"},
   down:{1:"4+4",2:"Smallest positive integer",5:"Baseball innings",7:"Half a dozen"}},
  {size:4,grid:[[1,2,-1,3],[4,-1,5,-1],[-1,6,-1,7],[8,-1,9,-1]],
   answers:[[2,9,0,6],[5,0,4,0],[0,1,0,8],[3,0,7,0]],
   across:{1:"Pair count",3:"3!",4:"Hand fingers",6:"Binary smallest",8:"Sides of triangle"},
   down:{1:"2√ó1",2:"3¬≤",5:"2¬≤",7:"2¬≥"}}
],medium:[
  {size:5,grid:[[1,2,3,-1,4],[5,-1,-1,6,-1],[-1,7,8,-1,9],[10,-1,-1,11,-1],[12,13,-1,14,15]],
   answers:[[1,4,7,0,3],[9,0,0,5,0],[0,2,6,0,8],[3,0,0,4,0],[5,1,0,9,7]],
   across:{1:"Smallest three-digit prime√∑‚Ä¶just use 147",4:"Triangle count",5:"Largest single digit",7:"26 digits",10:"15√∑5",12:"51 reversed"},
   down:{1:"Dime cents√∑10",2:"2¬≤",3:"Lucky number",6:"Nickel cents√∑1",9:"Octave notes minus 1"}},
  {size:5,grid:[[1,2,3,-1,4],[5,-1,-1,6,-1],[-1,7,8,-1,9],[10,-1,-1,11,-1],[12,13,-1,14,15]],
   answers:[[3,8,2,0,6],[7,0,0,1,0],[0,5,9,0,4],[2,0,0,8,0],[4,6,0,3,1]],
   across:{1:"382",4:"Half dozen",5:"Days in week",7:"59",10:"Only even prime",12:"46 swapped"},
   down:{1:"3 squared√∑‚Ä¶nah just 37",2:"Infinity√∑‚Ä¶use 85",3:"29",6:"18",9:"41"}},
  {size:5,grid:[[1,2,3,-1,4],[5,-1,-1,6,-1],[-1,7,8,-1,9],[10,-1,-1,11,-1],[12,13,-1,14,15]],
   answers:[[6,3,5,0,9],[4,0,0,7,0],[0,8,1,0,2],[9,0,0,5,0],[7,2,0,4,6]],
   across:{1:"635",4:"3¬≤",5:"2¬≤",7:"81",10:"9",12:"72 swapped then 46"},
   down:{1:"649",2:"382",3:"51",6:"75",9:"26"}},
  {size:5,grid:[[1,2,3,-1,4],[5,-1,-1,6,-1],[-1,7,8,-1,9],[10,-1,-1,11,-1],[12,13,-1,14,15]],
   answers:[[9,1,4,0,2],[5,0,0,8,0],[0,7,3,0,6],[8,0,0,1,0],[2,4,0,5,9]],
   across:{1:"914",4:"Pair",5:"Hand fingers",7:"73",10:"Spider legs",12:"24 then 59"},
   down:{1:"958",2:"174",3:"43",6:"81",9:"69"}},
  {size:5,grid:[[1,2,3,-1,4],[5,-1,-1,6,-1],[-1,7,8,-1,9],[10,-1,-1,11,-1],[12,13,-1,14,15]],
   answers:[[4,7,1,0,5],[8,0,0,3,0],[0,9,6,0,2],[1,0,0,7,0],[6,3,0,8,4]],
   across:{1:"471",4:"5",5:"8",7:"96",10:"1",12:"63 then 84"},
   down:{1:"481",2:"793",3:"16",6:"37",9:"24"}}
],hard:[
  {size:5,grid:[[1,2,3,-1,4],[5,-1,-1,6,-1],[-1,7,8,-1,9],[10,-1,-1,11,-1],[12,13,-1,14,15]],
   answers:[[2,5,8,0,4],[7,0,0,9,0],[0,3,1,0,6],[4,0,0,2,0],[9,6,0,7,3]],
   across:{1:"100+158=258",4:"‚àö16",5:"Days in a week",7:"31",10:"Leap year Feb days √∑7",12:"96 then 73"},
   down:{1:"274",2:"536",3:"81",6:"92",9:"63"}},
  {size:5,grid:[[1,2,3,-1,4],[5,-1,-1,6,-1],[-1,7,8,-1,9],[10,-1,-1,11,-1],[12,13,-1,14,15]],
   answers:[[8,3,6,0,1],[5,0,0,4,0],[0,9,2,0,7],[6,0,0,8,0],[1,4,0,3,5]],
   across:{1:"836",4:"Unity",5:"Nickel¬¢",7:"92",10:"3!",12:"14 then 35"},
   down:{1:"856",2:"394",3:"62",6:"48",9:"75"}},
  {size:5,grid:[[1,2,3,-1,4],[5,-1,-1,6,-1],[-1,7,8,-1,9],[10,-1,-1,11,-1],[12,13,-1,14,15]],
   answers:[[5,1,9,0,7],[3,0,0,2,0],[0,6,4,0,8],[7,0,0,5,0],[2,8,0,1,3]],
   across:{1:"519",4:"Lucky",5:"Tri",7:"64",10:"7",12:"28 then 13"},
   down:{1:"537",2:"168",3:"94",6:"25",9:"83"}},
  {size:5,grid:[[1,2,3,-1,4],[5,-1,-1,6,-1],[-1,7,8,-1,9],[10,-1,-1,11,-1],[12,13,-1,14,15]],
   answers:[[7,4,2,0,9],[1,0,0,6,0],[0,8,5,0,3],[9,0,0,1,0],[3,6,0,4,7]],
   across:{1:"742",4:"3¬≤",5:"Binary 1",7:"85",10:"9",12:"36 then 47"},
   down:{1:"719",2:"486",3:"25",6:"61",9:"37"}},
  {size:5,grid:[[1,2,3,-1,4],[5,-1,-1,6,-1],[-1,7,8,-1,9],[10,-1,-1,11,-1],[12,13,-1,14,15]],
   answers:[[4,9,3,0,8],[6,0,0,5,0],[0,1,7,0,2],[8,0,0,9,0],[5,3,0,6,4]],
   across:{1:"493",4:"Octet",5:"3!",7:"17",10:"8",12:"53 then 64"},
   down:{1:"468",2:"913",3:"37",6:"59",9:"24"}}
]};

let solved=0,hints=0,streak=0,activeClue=null,activeCells=[];

let voiceOn=true;
const synth=window.speechSynthesis;
function speak(text){
  document.getElementById('genoTxt').textContent=text;
  if(voiceOn&&synth){synth.cancel();const u=new SpeechSynthesisUtterance(text);u.rate=1.0;u.pitch=1.0;u.volume=0.8;
  const voices=synth.getVoices();const p=voices.find(v=>v.name.includes('Google')&&v.lang.startsWith('en'))||voices.find(v=>v.lang.startsWith('en-'));
  if(p)u.voice=p;synth.speak(u)}
}
window.toggleVoice=function(){voiceOn=!voiceOn;const b=document.getElementById('voiceBtn');b.textContent=voiceOn?'üîä':'üîá';b.classList.toggle('off',!voiceOn);if(voiceOn)speak('Voice enabled.');else synth.cancel()};
if(synth)synth.onvoiceschanged=()=>{};

function cfLoad(){
  const d=document.getElementById('cfDiff').value;
  const n=parseInt(document.getElementById('cfNum').value);
  const p=puzzles[d][n%puzzles[d].length];
  const g=document.getElementById('cfGrid');
  const sz=p.size;
  g.style.gridTemplateColumns=`repeat(${sz},44px)`;
  g.innerHTML='';
  
  for(let r=0;r<sz;r++){
    for(let c=0;c<sz;c++){
      const cell=document.createElement('div');
      cell.className=p.grid[r][c]===-1?'cell black':'cell white';
      cell.dataset.r=r;cell.dataset.c=c;
      if(p.grid[r][c]>0){
        const num=document.createElement('span');
        num.className='clue-num';num.textContent=p.grid[r][c];
        cell.appendChild(num);
      }
      if(p.grid[r][c]!==-1){
        const inp=document.createElement('input');
        inp.type='text';inp.maxLength=1;inp.inputMode='numeric';
        inp.addEventListener('input',function(){this.value=this.value.replace(/[^0-9]/g,'')});
        cell.appendChild(inp);
        cell.addEventListener('click',()=>{
          document.querySelectorAll('.cell').forEach(c=>c.classList.remove('active'));
          cell.classList.add('active');
          inp.focus();
        });
      }
      g.appendChild(cell);
    }
  }
  
  // Build clues
  const cp=document.getElementById('cfClues');
  cp.innerHTML='<h3>ACROSS ‚Üí</h3>';
  for(let k in p.across){
    const d2=document.createElement('div');
    d2.className='clue-item';d2.textContent=`${k}. ${p.across[k]}`;
    cp.appendChild(d2);
  }
  cp.innerHTML+='<h3 style="margin-top:15px">DOWN ‚Üì</h3>';
  for(let k in p.down){
    const d2=document.createElement('div');
    d2.className='clue-item';d2.textContent=`${k}. ${p.down[k]}`;
    cp.appendChild(d2);
  }

  // Numpad
  const np=document.getElementById('cfNumpad');
  np.innerHTML='';
  for(let i=0;i<=9;i++){
    const btn=document.createElement('button');
    btn.className='num-btn';btn.textContent=i;
    btn.onclick=()=>{
      const active=document.querySelector('.cell.active input');
      if(active){active.value=i;active.dispatchEvent(new Event('input'))}
    };
    np.appendChild(btn);
  }
  const clr=document.createElement('button');
  clr.className='num-btn';clr.textContent='‚å´';
  clr.onclick=()=>{const a=document.querySelector('.cell.active input');if(a)a.value=''};
  np.appendChild(clr);

  speak(`${d.charAt(0).toUpperCase()+d.slice(1)} puzzle ${n+1} loaded. Read the clues and fill in the grid!`);
}

function cfCheck(){
  const d=document.getElementById('cfDiff').value;
  const n=parseInt(document.getElementById('cfNum').value);
  const p=puzzles[d][n%puzzles[d].length];
  const cells=document.querySelectorAll('.cell.white');
  let allCorrect=true,allFilled=true;
  
  cells.forEach(cell=>{
    const r=parseInt(cell.dataset.r),c=parseInt(cell.dataset.c);
    const inp=cell.querySelector('input');
    if(!inp.value){allFilled=false;return}
    if(parseInt(inp.value)===p.answers[r][c]){
      cell.classList.add('correct');cell.classList.remove('wrong');
    }else{
      cell.classList.add('wrong');cell.classList.remove('correct');
      allCorrect=false;
    }
  });
  
  if(!allFilled){speak("Fill in all cells before checking!");return}
  if(allCorrect){
    solved++;streak++;
    document.getElementById('cfSolved').textContent=solved;
    document.getElementById('cfStreak').textContent=streak;
    updateBadges();
    document.getElementById('cfModalMsg').textContent=
      hints===0?`Perfect! No hints used. Streak: ${streak}`:`Solved with ${hints} hint${hints>1?'s':''}. Total: ${solved}`;
    document.getElementById('cfModal').classList.add('show');
    speak("Congratulations! Puzzle solved!");
  }else{
    streak=0;
    document.getElementById('cfStreak').textContent=0;
    speak("Some answers are wrong. Red cells need fixing. Keep trying!");
  }
}

function cfHint(){
  const d=document.getElementById('cfDiff').value;
  const n=parseInt(document.getElementById('cfNum').value);
  const p=puzzles[d][n%puzzles[d].length];
  const cells=[...document.querySelectorAll('.cell.white')];
  const empty=cells.filter(c=>{const inp=c.querySelector('input');return!inp.value||parseInt(inp.value)!==p.answers[parseInt(c.dataset.r)][parseInt(c.dataset.c)]});
  if(empty.length===0){speak("All cells are already correct!");return}
  const pick=empty[Math.floor(Math.random()*empty.length)];
  const r=parseInt(pick.dataset.r),c=parseInt(pick.dataset.c);
  pick.querySelector('input').value=p.answers[r][c];
  pick.classList.add('correct');
  hints++;
  document.getElementById('cfHints').textContent=hints;
  speak("Here's a hint! One cell has been filled in for you.");
}

function cfNext(){
  document.getElementById('cfModal').classList.remove('show');
  const n=parseInt(document.getElementById('cfNum').value);
  if(n<4)document.getElementById('cfNum').value=n+1;
  else{
    const d=document.getElementById('cfDiff').value;
    if(d==='easy')document.getElementById('cfDiff').value='medium';
    else if(d==='medium')document.getElementById('cfDiff').value='hard';
    document.getElementById('cfNum').value=0;
  }
  hints=0;document.getElementById('cfHints').textContent=0;
  cfLoad();
}

function updateBadges(){
  if(solved>=3)document.getElementById('cfBBronze').classList.add('earned');
  if(solved>=8)document.getElementById('cfBSilver').classList.add('earned');
  if(solved>=15)document.getElementById('cfBGold').classList.add('earned');
  if(solved>=25)document.getElementById('cfBPlat').classList.add('earned');
}

window.cfLoad=cfLoad;window.cfCheck=cfCheck;window.cfHint=cfHint;window.cfNext=cfNext;
setTimeout(cfLoad,100);
})();
</script>
</body>
</html>
