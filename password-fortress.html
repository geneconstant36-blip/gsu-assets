<!--
=====================================================
PASSWORD FORTRESS - GLOBAL SOVEREIGN UNIVERSITY
Digitification ¬∑ Band 1 ¬∑ DF-105
COMMAND CENTER AESTHETIC
=====================================================
URL: /password-fortress
Title: Password Fortress | Build Unbreakable Passwords | Free Cybersecurity Game | GSU
Meta Description: Learn password security through an interactive attack simulation. Build passwords, watch hackers try to crack them, and earn badges. Free cybersecurity education with AI tutor GENO.

CMS COLLECTION SETUP GUIDE FOR GENE:
=====================================
In Webflow, create a CMS Collection called "Games" with these fields:
  - Game Name (Plain Text) ‚Üí "Password Fortress"
  - Slug (Auto from name) ‚Üí "password-fortress"
  - Subject Area (Option) ‚Üí "Digitification"
  - Band Level (Option) ‚Üí "Band 1"
  - Game Code (Plain Text / Code) ‚Üí "DF-105"
  - Description (Plain Text) ‚Üí "Build the strongest password you can..."
  - Game Embed (Rich Text or Embed Code) ‚Üí paste game HTML here
  - Badge Type (Option) ‚Üí "Bronze / Silver / Gold / Platinum"
  - Icon Emoji (Plain Text) ‚Üí "üîê"
  - Amazon Book ASIN (Plain Text) ‚Üí "B0GJTZZ56T"
  - Amazon Book Title (Plain Text) ‚Üí "High on AI: The Hype, The Risks..."
  - Related Games (Multi-Reference) ‚Üí link to other Digitification games

Then create a CMS Template Page that pulls these fields dynamically.
The game embed code below goes into the Game Embed field.
=====================================================
-->

<!-- Google Fonts for Command Center aesthetic -->
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&family=Playfair+Display:wght@700;800;900&display=swap" rel="stylesheet">

<style>
/* ============================================
   SCOPED CSS ‚Äî all inside .mission-container
   Will not break Webflow site styles
   ============================================ */
.mission-container {
    box-sizing: border-box;
    --cyber: #0ea5e9;
    --cyber-glow: #38bdf8;
    --shield: #10b981;
    --shield-glow: #34d399;
    --alert: #f59e0b;
    --alert-glow: #fbbf24;
    --threat: #ef4444;
    --threat-glow: #f87171;
    --navy: #0f172a;
    --deep: #060a14;
    --slate: #94a3b8;
    --cream: #f8fafc;
    --teal: #2dd4bf;
    --gold: #d4a847;
    font-family: 'DM Sans', sans-serif;
    background: var(--deep);
    color: var(--cream);
    line-height: 1.7;
    position: relative;
    width: 100%;
    overflow-y: auto;
    border-radius: 0;
}
.mission-container *, .mission-container *::before, .mission-container *::after {
    box-sizing: border-box;
}

/* Background Effects */
.lab-bg {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 0; pointer-events: none; overflow: hidden;
}
.lab-bg::before {
    content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background: radial-gradient(ellipse at 30% 40%, rgba(14,165,233,.06) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 60%, rgba(16,185,129,.04) 0%, transparent 50%);
    animation: labPulse 20s ease-in-out infinite;
}
@keyframes labPulse { 0%,100% {transform: translate(0,0)} 50% {transform: translate(-2%,1%)} }

.scan-lines {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 0; pointer-events: none;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(14,165,233,.008) 2px, rgba(14,165,233,.008) 4px);
    opacity: .6;
}

.game-wrap {
    position: relative; z-index: 1;
    max-width: 800px; margin: 0 auto; padding: 40px 24px 60px;
}

/* Header */
.game-badge {
    display: inline-flex; align-items: center; gap: 8px;
    background: rgba(14,165,233,.1); border: 1px solid rgba(14,165,233,.3);
    border-radius: 100px; padding: 6px 16px; margin-bottom: 20px;
    font-family: 'JetBrains Mono', monospace; font-size: 11px;
    letter-spacing: 2px; text-transform: uppercase;
    color: var(--cyber); font-weight: 600;
}
.game-badge .dot {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--cyber); animation: pulse 2s infinite;
}
@keyframes pulse { 0%,100% {opacity: 1} 50% {opacity: .3} }

.game-title {
    font-family: 'Playfair Display', serif;
    font-size: clamp(28px, 5vw, 48px); font-weight: 900;
    margin-bottom: 8px; color: white;
}
.game-title .accent { color: var(--cyber-glow); }
.game-sub {
    font-size: 16px; color: var(--slate);
    margin-bottom: 40px; max-width: 600px;
}

/* Fortress Visual */
.fortress {
    position: relative; padding: 40px 24px; border-radius: 24px;
    background: rgba(255,255,255,.02); border: 1px solid rgba(255,255,255,.06);
    margin-bottom: 32px; transition: all .6s;
}
.fortress.strength-0 { border-color: rgba(239,68,68,.3); box-shadow: 0 0 40px rgba(239,68,68,.05); }
.fortress.strength-1 { border-color: rgba(245,158,11,.3); box-shadow: 0 0 40px rgba(245,158,11,.05); }
.fortress.strength-2 { border-color: rgba(14,165,233,.3); box-shadow: 0 0 40px rgba(14,165,233,.05); }
.fortress.strength-3 { border-color: rgba(16,185,129,.3); box-shadow: 0 0 40px rgba(16,185,129,.08); }
.fortress.strength-4 { border-color: rgba(212,168,71,.4); box-shadow: 0 0 60px rgba(212,168,71,.1); }

/* Walls */
.walls {
    display: flex; justify-content: center; gap: 6px;
    margin-bottom: 24px; height: 80px; align-items: flex-end;
}
.wall-block {
    width: 40px; border-radius: 6px 6px 0 0;
    transition: all .5s cubic-bezier(.4,0,.2,1); opacity: .2;
}
.wall-block.active { opacity: 1; }
.wall-block:nth-child(1) { background: var(--threat); }
.wall-block:nth-child(2) { background: var(--alert); }
.wall-block:nth-child(3) { background: var(--cyber); }
.wall-block:nth-child(4) { background: var(--shield); }
.wall-block:nth-child(5) { background: var(--gold); }

/* Password Input */
.pw-input-wrap { position: relative; margin-bottom: 20px; }
.pw-input {
    width: 100%; padding: 16px 52px 16px 20px; border-radius: 16px;
    border: 2px solid rgba(255,255,255,.1); background: rgba(0,0,0,.4);
    color: var(--cream); font-family: 'JetBrains Mono', monospace;
    font-size: 20px; letter-spacing: 3px; outline: none;
    transition: border-color .3s;
}
.pw-input:focus { border-color: var(--cyber); }
.pw-toggle {
    position: absolute; right: 16px; top: 50%; transform: translateY(-50%);
    background: none; border: none; color: var(--slate);
    font-size: 20px; cursor: pointer; padding: 4px;
}

/* Strength Meter */
.strength-bar { height: 6px; border-radius: 3px; background: rgba(255,255,255,.06); margin-bottom: 16px; overflow: hidden; }
.strength-fill { height: 100%; border-radius: 3px; transition: all .5s; width: 0; }
.strength-fill.s0 { width: 5%; background: var(--threat); }
.strength-fill.s1 { width: 25%; background: var(--threat); }
.strength-fill.s2 { width: 50%; background: var(--alert); }
.strength-fill.s3 { width: 75%; background: var(--cyber); }
.strength-fill.s4 { width: 100%; background: var(--shield); }
.strength-label {
    font-family: 'JetBrains Mono', monospace; font-size: 13px;
    letter-spacing: 1px; font-weight: 600; margin-bottom: 24px;
    transition: color .3s;
}

/* Crack Time Panel */
.crack-panel {
    padding: 24px; border-radius: 16px;
    background: rgba(0,0,0,.3); border: 1px solid rgba(255,255,255,.06);
    margin-bottom: 24px;
}
.crack-label {
    font-family: 'JetBrains Mono', monospace; font-size: 11px;
    letter-spacing: 2px; text-transform: uppercase;
    color: var(--slate); margin-bottom: 8px;
}
.crack-time {
    font-family: 'Playfair Display', serif;
    font-size: clamp(24px, 4vw, 36px); font-weight: 900;
    margin-bottom: 4px; transition: color .3s;
}
.crack-method {
    font-size: 13px; color: var(--slate);
    font-family: 'JetBrains Mono', monospace;
}

/* Check Items */
.checks { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 32px; }
@media(max-width: 600px) { .checks { grid-template-columns: 1fr; } }
.check-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 14px; border-radius: 12px;
    background: rgba(255,255,255,.02); border: 1px solid rgba(255,255,255,.04);
    transition: all .4s; font-size: 14px; color: var(--slate);
}
.check-item.pass {
    border-color: rgba(16,185,129,.25);
    background: rgba(16,185,129,.06); color: var(--shield-glow);
}
.check-icon {
    width: 22px; height: 22px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 12px; flex-shrink: 0;
    border: 2px solid rgba(255,255,255,.1); transition: all .3s;
}
.check-item.pass .check-icon {
    background: rgba(16,185,129,.2);
    border-color: var(--shield-glow); color: var(--shield-glow);
}

/* Attack Button */
.attack-btn {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 14px 28px; border-radius: 100px;
    font-family: 'DM Sans', sans-serif; font-size: 15px; font-weight: 700;
    border: none; cursor: pointer; transition: all .3s; letter-spacing: 1px;
    background: linear-gradient(135deg, var(--threat), #b91c1c); color: white;
    margin-bottom: 24px;
}
.attack-btn:hover { box-shadow: 0 8px 32px rgba(239,68,68,.3); transform: translateY(-2px); }
.attack-btn:disabled { opacity: .4; cursor: not-allowed; transform: none; box-shadow: none; }

/* Attack Log */
.attack-log {
    padding: 20px; border-radius: 16px;
    background: rgba(0,0,0,.5); border: 1px solid rgba(239,68,68,.15);
    font-family: 'JetBrains Mono', monospace; font-size: 12px;
    line-height: 1.8; color: var(--slate);
    max-height: 200px; overflow-y: auto;
    display: none; margin-bottom: 32px;
}
.attack-log.active { display: block; }
.log-line { opacity: 0; animation: logIn .3s ease-out forwards; }
@keyframes logIn { to { opacity: 1; } }
.log-fail { color: var(--threat-glow); }
.log-try { color: var(--alert-glow); }
.log-success { color: var(--shield-glow); font-weight: 700; }

/* Score Panel */
.score-panel {
    padding: 28px 24px; border-radius: 20px;
    background: rgba(212,168,71,.06); border: 1px solid rgba(212,168,71,.2);
    text-align: center; display: none; margin-bottom: 32px;
}
.score-panel.active { display: block; }
.score-grade {
    font-family: 'Playfair Display', serif;
    font-size: 48px; font-weight: 900; margin-bottom: 4px;
}
.score-grade.grade-f { color: var(--threat-glow); }
.score-grade.grade-d { color: var(--alert-glow); }
.score-grade.grade-c { color: var(--alert); }
.score-grade.grade-b { color: var(--cyber-glow); }
.score-grade.grade-a { color: var(--gold); }

/* Tips */
.tips {
    padding: 28px 24px; border-radius: 20px;
    background: rgba(14,165,233,.04); border: 1px solid rgba(14,165,233,.15);
    margin-bottom: 32px;
}
.tips-title {
    font-family: 'JetBrains Mono', monospace; font-size: 12px;
    letter-spacing: 2px; text-transform: uppercase;
    color: var(--cyber-glow); font-weight: 600; margin-bottom: 12px;
}
.tips-list { list-style: none; padding: 0; margin: 0; }
.tips-list li {
    font-size: 14px; color: var(--slate);
    padding: 6px 0 6px 20px; position: relative;
}
.tips-list li::before {
    content: '‚Ä∫'; position: absolute; left: 0;
    color: var(--cyber-glow); font-weight: 700;
}

/* ============================================
   BOOK PROMO SECTION ‚Äî Amazon SEO Link
   ============================================ */
.book-promo {
    padding: 28px 24px; border-radius: 20px;
    background: rgba(212,168,71,.04); border: 1px solid rgba(212,168,71,.2);
    margin-bottom: 32px;
    display: flex; align-items: center; gap: 24px;
    flex-wrap: wrap;
    transition: all 0.3s;
}
.book-promo:hover {
    border-color: rgba(212,168,71,.4);
    box-shadow: 0 0 40px rgba(212,168,71,.08);
}
.book-cover-placeholder {
    width: 120px; min-width: 120px; height: 170px;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(14,165,233,.15), rgba(212,168,71,.15));
    border: 1px solid rgba(255,255,255,.1);
    display: flex; align-items: center; justify-content: center;
    font-size: 48px; flex-shrink: 0;
}
.book-info { flex: 1; min-width: 240px; }
.book-promo-label {
    font-family: 'JetBrains Mono', monospace; font-size: 11px;
    letter-spacing: 2px; text-transform: uppercase;
    color: var(--gold); font-weight: 600; margin-bottom: 8px;
}
.book-promo-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem; font-weight: 900; color: white;
    margin-bottom: 4px; line-height: 1.3;
}
.book-promo-author {
    font-size: 0.85rem; color: var(--slate); margin-bottom: 10px;
}
.book-promo-desc {
    font-size: 0.9rem; color: rgba(255,255,255,.7);
    margin-bottom: 16px; line-height: 1.6;
}
.book-promo-link {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 10px 22px; border-radius: 100px;
    background: linear-gradient(135deg, var(--gold), #f4d03f);
    color: #0a192f; text-decoration: none;
    font-family: 'DM Sans', sans-serif; font-size: 14px;
    font-weight: 700; transition: all 0.3s;
}
.book-promo-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(212,168,71,.3);
}

/* Utility buttons */
.reset-btn {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 12px 24px; border-radius: 100px;
    font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 600;
    border: 1px solid rgba(255,255,255,.15);
    background: rgba(255,255,255,.06); color: var(--cream);
    cursor: pointer; transition: all 0.3s;
}
.reset-btn:hover { background: rgba(255,255,255,.1); }

.back-link {
    display: inline-flex; align-items: center; gap: 8px;
    margin-top: 20px;
    font-family: 'JetBrains Mono', monospace; font-size: 13px;
    color: var(--cyber); text-decoration: none;
    transition: color 0.3s;
}
.back-link:hover { color: var(--cyber-glow); }

/* ============================================
   GSU MISSION FOOTER (matches site)
   ============================================ */
.gsu-mission-bar {
    max-width: 800px; margin: 0 auto; padding: 0 24px 40px;
    position: relative; z-index: 1;
}
.gsu-mission-card {
    padding: 25px; border: 2px solid var(--gold);
    border-radius: 16px; text-align: center;
}
.gsu-mission-card p {
    font-family: 'DM Sans', sans-serif; font-size: 1.1rem;
    color: var(--gold); margin: 0; font-style: italic; font-weight: 600;
}
</style>

<!-- ==================== PASSWORD FORTRESS GAME ==================== -->
<div class="mission-container">
    <div class="lab-bg"></div>
    <div class="scan-lines"></div>

    <div class="game-wrap">

        <!-- Game Badge -->
        <div class="game-badge"><span class="dot"></span> Digitification ‚Äî Band 1 ‚Äî DF-105</div>

        <!-- Title -->
        <h1 class="game-title">Password <span class="accent">Fortress</span></h1>
        <p class="game-sub">Build the strongest password you can. Watch a simulated attacker try to crack it. Learn what makes a password an unbreakable wall.</p>

        <!-- ===== FORTRESS GAME ===== -->
        <div class="fortress strength-0" id="fortress">

            <!-- Wall Visualization -->
            <div class="walls" id="walls">
                <div class="wall-block" id="w1" style="height:16px"></div>
                <div class="wall-block" id="w2" style="height:16px"></div>
                <div class="wall-block" id="w3" style="height:16px"></div>
                <div class="wall-block" id="w4" style="height:16px"></div>
                <div class="wall-block" id="w5" style="height:16px"></div>
            </div>

            <!-- Password Input -->
            <div class="pw-input-wrap">
                <input type="password" class="pw-input" id="pwInput" placeholder="Type your password..." autocomplete="off" spellcheck="false">
                <button class="pw-toggle" id="pwToggle" title="Show/hide password">üëÅÔ∏è</button>
            </div>

            <!-- Strength Meter -->
            <div class="strength-bar"><div class="strength-fill s0" id="strengthFill"></div></div>
            <div class="strength-label" id="strengthLabel">Waiting for input...</div>

            <!-- Crack Time -->
            <div class="crack-panel">
                <div class="crack-label">‚è±Ô∏è Estimated time to crack</div>
                <div class="crack-time" id="crackTime" style="color:var(--slate)">‚Äî</div>
                <div class="crack-method" id="crackMethod">Enter a password to begin</div>
            </div>

            <!-- Requirement Checks -->
            <div class="checks">
                <div class="check-item" id="chkLen"><div class="check-icon">‚úï</div>8+ characters</div>
                <div class="check-item" id="chkUpper"><div class="check-icon">‚úï</div>Uppercase letter</div>
                <div class="check-item" id="chkLower"><div class="check-icon">‚úï</div>Lowercase letter</div>
                <div class="check-item" id="chkNum"><div class="check-icon">‚úï</div>Number</div>
                <div class="check-item" id="chkSpecial"><div class="check-icon">‚úï</div>Special character</div>
                <div class="check-item" id="chkLong"><div class="check-icon">‚úï</div>12+ characters (bonus)</div>
            </div>

            <!-- Attack Button -->
            <button class="attack-btn" id="attackBtn" disabled>‚öîÔ∏è Launch Attack Simulation</button>
        </div>

        <!-- Attack Log -->
        <div class="attack-log" id="attackLog"></div>

        <!-- Score Panel -->
        <div class="score-panel" id="scorePanel">
            <div class="score-grade" id="scoreGrade"></div>
            <div class="score-msg" id="scoreMsg" style="font-size:18px; color:var(--cream); margin-bottom:4px;"></div>
            <div class="score-detail" id="scoreDetail" style="font-size:13px; color:var(--slate); font-family:'JetBrains Mono',monospace;"></div>
        </div>

        <!-- Tips -->
        <div class="tips">
            <div class="tips-title">üõ°Ô∏è Password Defense Intel</div>
            <ul class="tips-list">
                <li>Length beats complexity. A 16-character passphrase is stronger than an 8-character jumble.</li>
                <li>Never reuse passwords. One breach = every account compromised.</li>
                <li>Use a password manager. Your brain is not a secure vault.</li>
                <li>Common substitutions (@ for a, 3 for e) do not fool modern crackers.</li>
                <li>Two-factor authentication (2FA) is your second wall. Always enable it.</li>
            </ul>
        </div>

        <!-- ===== BOOK PROMO ‚Äî Amazon SEO Link ===== -->
        <div class="book-promo">
            <div class="book-cover-placeholder">üìï</div>
            <div class="book-info">
                <div class="book-promo-label">üìö From the GSU Bookstore</div>
                <div class="book-promo-title">High on AI: The Hype, The Risks, and The Real Future</div>
                <div class="book-promo-author">By Gene Genie ¬∑ Global Sovereign University</div>
                <div class="book-promo-desc">
                    Password security is just the beginning. Understand the full landscape of AI-driven threats and opportunities ‚Äî from deepfakes to digital sovereignty. Essential reading for anyone navigating the digital age.
                </div>
                <a href="https://www.amazon.com/dp/B0GJTZZ56T" class="book-promo-link" target="_blank" rel="noopener">
                    üìñ Get the Book on Amazon ‚Üí
                </a>
            </div>
        </div>

        <!-- Reset & Navigation -->
        <button class="reset-btn" id="resetBtn">üîÑ Reset & Try Again</button>

        <div>
            <a href="/digitification" class="back-link">‚Üê Back to Digitification</a>
            <a href="/games" class="back-link" style="margin-left: 20px;">üéÆ All Games</a>
        </div>

    </div>

    <!-- GSU Mission Bar -->
    <div class="gsu-mission-bar">
        <div class="gsu-mission-card">
            <p>"Building a Bridge to Freedom Through Education‚ÄîNot Handouts"</p>
        </div>
    </div>

</div>

<!-- ==================== GAME LOGIC ==================== -->
<script>
(function() {
    const pwInput = document.getElementById('pwInput');
    const pwToggle = document.getElementById('pwToggle');
    const strengthFill = document.getElementById('strengthFill');
    const strengthLabel = document.getElementById('strengthLabel');
    const crackTime = document.getElementById('crackTime');
    const crackMethod = document.getElementById('crackMethod');
    const fortress = document.getElementById('fortress');
    const attackBtn = document.getElementById('attackBtn');
    const attackLog = document.getElementById('attackLog');
    const scorePanel = document.getElementById('scorePanel');
    const scoreGrade = document.getElementById('scoreGrade');
    const scoreMsg = document.getElementById('scoreMsg');
    const scoreDetail = document.getElementById('scoreDetail');
    const resetBtn = document.getElementById('resetBtn');

    const checks = {
        chkLen: pw => pw.length >= 8,
        chkUpper: pw => /[A-Z]/.test(pw),
        chkLower: pw => /[a-z]/.test(pw),
        chkNum: pw => /[0-9]/.test(pw),
        chkSpecial: pw => /[^A-Za-z0-9]/.test(pw),
        chkLong: pw => pw.length >= 12,
    };

    const commonPasswords = ['password','123456','12345678','qwerty','abc123','monkey','1234567','letmein','trustno1','dragon','baseball','iloveyou','master','sunshine','ashley','michael','shadow','123123','654321','superman','hello','charlie','donald','password1','admin','welcome'];

    const walls = ['w1','w2','w3','w4','w5'];

    function calcStrength(pw) {
        if (!pw) return 0;
        let score = 0;
        if (pw.length >= 8) score++;
        if (/[A-Z]/.test(pw) && /[a-z]/.test(pw)) score++;
        if (/[0-9]/.test(pw)) score++;
        if (/[^A-Za-z0-9]/.test(pw)) score++;
        if (pw.length >= 12) score++;
        if (commonPasswords.includes(pw.toLowerCase())) score = 1;
        if (pw.length < 4) score = Math.min(score, 1);
        return Math.min(score, 4);
    }

    function calcPoolSize(pw) {
        let pool = 0;
        if (/[a-z]/.test(pw)) pool += 26;
        if (/[A-Z]/.test(pw)) pool += 26;
        if (/[0-9]/.test(pw)) pool += 10;
        if (/[^A-Za-z0-9]/.test(pw)) pool += 33;
        return pool || 26;
    }

    function calcCrackTime(pw) {
        if (!pw) return { text: '‚Äî', method: 'Enter a password to begin', seconds: 0 };
        if (commonPasswords.includes(pw.toLowerCase())) {
            return { text: '< 1 second', method: 'Found in common password dictionary', seconds: 0.001 };
        }
        const pool = calcPoolSize(pw);
        const combinations = Math.pow(pool, pw.length);
        const guessesPerSec = 10e9;
        const seconds = combinations / guessesPerSec / 2;
        let text;
        if (seconds < 0.001) text = '< 1 millisecond';
        else if (seconds < 1) text = '< 1 second';
        else if (seconds < 60) text = Math.round(seconds) + ' seconds';
        else if (seconds < 3600) text = Math.round(seconds/60) + ' minutes';
        else if (seconds < 86400) text = Math.round(seconds/3600) + ' hours';
        else if (seconds < 86400*30) text = Math.round(seconds/86400) + ' days';
        else if (seconds < 86400*365) text = Math.round(seconds/86400/30) + ' months';
        else if (seconds < 86400*365*1000) text = Math.round(seconds/86400/365) + ' years';
        else if (seconds < 86400*365*1e6) text = Math.round(seconds/86400/365/1000).toLocaleString() + ' thousand years';
        else if (seconds < 86400*365*1e9) text = Math.round(seconds/86400/365/1e6).toLocaleString() + ' million years';
        else if (seconds < 86400*365*1e12) text = Math.round(seconds/86400/365/1e9).toLocaleString() + ' billion years';
        else text = '> age of the universe';
        return { text, method: 'At 10 billion guesses/sec ¬∑ ' + pool + ' char pool', seconds };
    }

    function updateUI() {
        const pw = pwInput.value;
        const strength = calcStrength(pw);
        const crack = calcCrackTime(pw);

        Object.entries(checks).forEach(function([id, fn]) {
            const el = document.getElementById(id);
            if (el) {
                const pass = fn(pw);
                el.classList.toggle('pass', pass);
                el.querySelector('.check-icon').textContent = pass ? '‚úì' : '‚úï';
            }
        });

        if (strengthFill) strengthFill.className = 'strength-fill s' + (pw ? strength : 0);

        const labels = ['No password entered','Weak ‚Äî instantly crackable','Fair ‚Äî minutes to hours','Strong ‚Äî years to crack','Fortress ‚Äî centuries+'];
        if (strengthLabel) {
            strengthLabel.textContent = pw ? labels[strength] : labels[0];
            strengthLabel.className = 'strength-label s' + (pw ? strength : 0);
        }

        if (fortress) fortress.className = 'fortress strength-' + (pw ? strength : 0);

        walls.forEach(function(id, i) {
            const el = document.getElementById(id);
            if (el) {
                const active = i < strength;
                el.classList.toggle('active', active);
                el.style.height = active ? (16 + (i+1) * 14) + 'px' : '16px';
            }
        });

        if (crackTime) {
            crackTime.textContent = crack.text;
            crackTime.style.color = pw ? ['var(--slate)','var(--threat-glow)','var(--alert-glow)','var(--cyber-glow)','var(--shield-glow)'][strength] : 'var(--slate)';
        }
        if (crackMethod) crackMethod.textContent = crack.method;
        if (attackBtn) attackBtn.disabled = !pw;
    }

    if (pwToggle) {
        pwToggle.addEventListener('click', function() {
            const isPass = pwInput.type === 'password';
            pwInput.type = isPass ? 'text' : 'password';
            pwToggle.textContent = isPass ? 'üôà' : 'üëÅÔ∏è';
        });
    }

    if (pwInput) {
        pwInput.addEventListener('input', function() {
            updateUI();
            attackLog.classList.remove('active');
            scorePanel.classList.remove('active');
        });
    }

    if (attackBtn) {
        attackBtn.addEventListener('click', function() {
            const pw = pwInput.value;
            if (!pw) return;
            attackBtn.disabled = true;
            attackLog.innerHTML = '';
            attackLog.classList.add('active');
            scorePanel.classList.remove('active');

            const strength = calcStrength(pw);
            const crack = calcCrackTime(pw);
            const isCommon = commonPasswords.includes(pw.toLowerCase());
            const phases = [];

            phases.push({ text: '> Initializing dictionary attack...', cls: 'log-try', delay: 200 });
            phases.push({ text: '> Loading 10,000 common passwords...', cls: 'log-try', delay: 600 });

            if (isCommon) {
                phases.push({ text: '> MATCH FOUND: "' + pw + '" is in common password list', cls: 'log-fail', delay: 1000 });
                phases.push({ text: '> ‚ö†Ô∏è PASSWORD CRACKED IN < 1 SECOND', cls: 'log-fail', delay: 1400 });
            } else {
                phases.push({ text: '> No dictionary match found. Proceeding...', cls: 'log-success', delay: 1000 });
                phases.push({ text: '> Running pattern analysis...', cls: 'log-try', delay: 1600 });
                var hasSequence = /abc|bcd|cde|def|123|234|345|456|567|678|789|qwe|wer|ert|asd|sdf/i.test(pw);
                var hasRepeat = /(.)\1{2,}/.test(pw);
                if (hasSequence) phases.push({ text: '> ‚ö†Ô∏è Sequential pattern detected', cls: 'log-fail', delay: 2000 });
                else if (hasRepeat) phases.push({ text: '> ‚ö†Ô∏è Repeated characters detected', cls: 'log-fail', delay: 2000 });
                else phases.push({ text: '> No predictable patterns found.', cls: 'log-success', delay: 2000 });
                phases.push({ text: '> Initiating brute force...', cls: 'log-try', delay: 2600 });
                phases.push({ text: '> Pool: ' + calcPoolSize(pw) + ' ¬∑ Len: ' + pw.length, cls: 'log-try', delay: 3000 });
                if (crack.seconds < 1) phases.push({ text: '> ‚ö†Ô∏è CRACKED: ' + crack.text, cls: 'log-fail', delay: 3800 });
                else if (crack.seconds < 86400) phases.push({ text: '> ‚ö†Ô∏è VULNERABLE: ' + crack.text, cls: 'log-fail', delay: 3800 });
                else if (crack.seconds < 86400 * 365 * 100) phases.push({ text: '> üõ°Ô∏è RESISTANT: ' + crack.text, cls: 'log-success', delay: 3800 });
                else phases.push({ text: '> üè∞ FORTRESS HOLDS: ' + crack.text, cls: 'log-success', delay: 3800 });
            }
            phases.push({ text: '> Simulation complete.', cls: 'log-try', delay: phases[phases.length-1].delay + 600 });

            phases.forEach(function(p) {
                setTimeout(function() {
                    var line = document.createElement('div');
                    line.className = 'log-line ' + p.cls;
                    line.textContent = p.text;
                    line.style.animationDelay = '0s';
                    attackLog.appendChild(line);
                    attackLog.scrollTop = attackLog.scrollHeight;
                }, p.delay);
            });

            setTimeout(function() {
                scorePanel.classList.add('active');
                var grades = [
                    { letter: 'F', cls: 'grade-f', msg: 'Open door. No protection.' },
                    { letter: 'D', cls: 'grade-d', msg: 'Weak. Easily cracked.' },
                    { letter: 'C', cls: 'grade-c', msg: 'Getting there. Keep building.' },
                    { letter: 'B', cls: 'grade-b', msg: 'Strong defense.' },
                    { letter: 'A', cls: 'grade-a', msg: 'Fortress. You are sovereign.' },
                ];
                var g = grades[strength];
                scoreGrade.textContent = g.letter;
                scoreGrade.className = 'score-grade ' + g.cls;
                scoreMsg.textContent = g.msg;
                var details = 'Crack time: ' + crack.text;
                if (isCommon) details += ' ¬∑ Common password!';
                scoreDetail.textContent = details;
                attackBtn.disabled = false;
            }, phases[phases.length-1].delay + 800);
        });
    }

    if (resetBtn) {
        resetBtn.addEventListener('click', function() {
            pwInput.value = '';
            pwInput.type = 'password';
            pwToggle.textContent = 'üëÅÔ∏è';
            attackLog.classList.remove('active');
            attackLog.innerHTML = '';
            scorePanel.classList.remove('active');
            updateUI();
            pwInput.focus();
        });
    }

    updateUI();
})();
</script>
